---
'$title': Система макетов AMPHTML
$order: 1
formats:
  - websites
  - email
  - stories
  - ads
teaser:
  text: Обзор
---

<!--
This file is imported from https://github.com/ampproject/amphtml/blob/master/spec/amp-html-layout.md.
Please do not change this file.
If you have found a bug or an issue please
have a look and request a pull request there.
-->

<!---
Copyright 2015 The AMP HTML Authors. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS-IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

## Обзор <a name="overview"></a>

Основное предназначение системы макетов — предоставление элементам AMP возможности указывать свой макет, что, в свою очередь, позволяет среде выполнения определять размер элементов до выполнения каких-либо операций с удаленными ресурсами, таких как запросы JavaScript и загрузка данных. Эта возможность важна, поскольку позволяет значительно сократить задержки при рендеринге и прокрутке страницы.

Система макетов AMP спроектирована так, чтобы поддерживать небольшое число гибких макетов, гарантирующих высокую производительность. Для выражения требований элемента к своему макету и размерам эта система использует ряд атрибутов, таких как `layout`, `width`, `height`, `sizes` и `heights`.

## Поведение <a name="behavior"></a>

Неконтейнерный элемент AMP (т. е. в котором `layout != container`) изначально запускается в режиме «незавершенной компоновки», в котором все его дочерние элементы скрыты, за исключением заполнителя (см. описание атрибута `placeholder`). Данные, необходимые для завершения компоновки элемента, могут все еще загружаться и инициализироваться, но среда выполнения AMP уже знает размер и местоположение элемента на основании только классов CSS и атрибутов `layout`, `width`, `height` и `media`. Размер и позиция элементов-заполнителей (`placeholder`), при их наличии, в большинстве случаев совпадает с размером и местоположением родительского элемента.

Заполнитель (`placeholder`) скрывается, как только компоновка первого макета его родительского элемента будет завершена. На этом этапе предполагается, что все дочерние элементы элемента корректно скомпонованы, позиционированы, готовы к отображению, а также готовы принимать ввод данных от пользователя. Таково поведение по умолчанию, однако каждый элемент может переопределить его — например, скрыть `placeholder` быстрее или отображать его дольше.

Установка размера и отображение элемента осуществляется средой выполнения на основании атрибутов `layout`, `width`, `height` и `media`. Реализация всех правил макета является внутренней и выполняется с помощью CSS. Считается, что элемент «указывает размер», если его размер можно получить с помощью стилей CSS и он не меняется в зависимости от дочерних элементов: как доступных немедленно, так и добавленных динамически. Это не означает, что размер этого элемента не может измениться. Макет может быть полностью динамическим, как и в случае с макетами `responsive`, `fixed-height`, `fill` и `flex-item`. Это просто означает, что размер не изменяется без явного действия со стороны пользователя (например, при рендеринге, прокрутке или загрузке публикации).

Если элемент настроен неправильно, в среде PROD он не будет отображаться вообще, а в cреде DEV будет отображен с состоянием ошибки. В числе возможных ошибок могут быть недопустимые или неподдерживаемые значения атрибутов `layout`, `width` и `height`.

## Атрибут layout <a name="layout-attributes"></a>

### `width` и `height` <a name="width-and-height"></a>

Значение атрибута `layout` определяет, должны ли элементы AMP-компонента содержать атрибуты `width` и `height`, указывающие количество пикселей в формате целых чисел. Фактическое поведение макета определяется атрибутом `layout`, как описано ниже.

Если атрибуты `width` и `height` не указаны, то в некоторых случаях среда выполнения AMP может задать им исходные значения самостоятельно:

- `amp-pixel`: для `width` и `height` по умолчанию устанавливается значение 0.
- `amp-audio`: значения `width` и `height` по умолчанию определяются параметрами браузера.

### `layout` <a name="layout"></a>

AMP предоставляет набор макетов, которые определяют поведение компонента AMP в рамках макета документа. Чтобы указать макет компонента, добавьте атрибут `layout` с одним из значений, указанных в таблице ниже.

**Пример**: простое адаптивное изображение, ширина и высота которого используются для определения соотношения сторон.

[sourcecode:html]
<amp-img
src="/img/amp.jpg"
width="1080"
height="610"
layout="responsive"
alt="an image"

> </amp-img>
> [/sourcecode]

Поддерживаемые значения атрибута `layout`:

<table>
  <thead>
    <tr>
      <th width="30%">Значение</th>
      <th>Поведение и требования</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Нет</td>
      <td>Если значение не указано, макет компонента определяется следующим образом: <ul>
<li> Если <code>height</code> присутствует, а <code>width</code> отсутствует или имеет значение <code>auto</code>, предполагается макет <code>fixed-height</code>. </li>
<li> Если <code>width</code> и <code>height</code> присутствуют вместе с атрибутом <code>sizes</code> или <code>heights</code>, предполагается макет <code>responsive</code>. </li>
<li> Если указаны <code>width</code> и <code>height</code>, предполагается макет <code>fixed</code>. </li>
<li> Если <code>width</code> и <code>height</code> отсутствуют, предполагается макет <code>container</code>. </li>
</ul>
</td>
    </tr>
    <tr>
      <td><code>container</code></td>
      <td>Размеры элемента определяют его дочерние элементы, как и в случае HTML-элемента <code>div</code>. Предполагается, что элемент выступает только в качестве контейнера и не имеет определенного собственного макета. Его дочерние элементы отображаются сразу.</td>
    </tr>
    <tr>
      <td><code>fill</code></td>
      <td>Элемент занимает доступное ему пространство — как в ширину, так и в высоту. Другими словами, макет и размер элемента <code>fill</code> соответствуют его родительскому элементу. Чтобы элемент заполнил свой родительский контейнер, укажите макет «fill» и убедитесь, что в родительском контейнере указано <code>position:relative</code> или <code>position:absolute</code>.</td>
    </tr>
    <tr>
      <td><code>fixed</code></td>
      <td>Элемент имеет фиксированную ширину и высоту без поддержки адаптивности. Атрибуты <code>width</code> и <code>height</code> должны присутствовать. Исключения — компоненты <code>amp-pixel</code> и <code>amp-audio</code>.</td>
    </tr>
    <tr>
      <td><code>fixed-height</code></td>
      <td>Элемент занимает доступное ему пространство, но сохраняет высоту неизменной. Этот макет хорошо подходит для таких элементов, как <code>amp-carousel</code>, в которых контент расположен горизонтально. Атрибут <code>height</code> должен присутствовать. Атрибут <code>width</code> не должен быть указан или должен иметь значение <code>auto</code>.</td>
    </tr>
    <tr>
      <td><code>flex-item</code></td>
      <td>Этот элемент и другие элементы в его родительском элементе с типом макета <code>flex-item</code> занимают оставшееся пространство родительского контейнера, если родительский элемент является гибким контейнером (например, <code>display: flex</code>). Атрибуты <code>width</code> и <code>height</code> не требуются.</td>
    </tr>
    <tr>
      <td><code>intrinsic</code></td>
      <td>Элемент занимает доступное ему пространство и автоматически изменяет свою высоту до соотношения сторон, заданного атрибутами <code>width</code> и <code>height</code>, <em>пока</em> не достигнет размера элемента, определенного атрибутами width и height, переданными в <code>amp-img</code>, или не достигнет ограничения CSS, такого как `max-width`. Атрибуты ширины и высоты должны быть указаны. Этот макет очень хорошо работает с большинством элементов AMP, включая <code>amp-img</code>, <code>amp-carousel</code> и т. п. Доступное пространство зависит от родительского элемента, а также может быть настроено с помощью CSS-свойства <code>max-width</code>. Этот макет отличается от <code>responsive</code> тем, что имеет собственную высоту и ширину. Это наиболее очевидно внутри плавающего элемента, где макет <code>responsive</code> будет отображать 0x0, а макет <code>intrinsic</code> увеличится до меньшего из своего естественного размера или какого-либо ограничения CSS.</td>
    </tr>
    <tr>
      <td><code>nodisplay</code></td>
      <td>Элемент не отображается и занимает нулевое пространство на экране (как при использовании стиля <code>display: none</code>). Этот макет можно применить к любому элементу AMP. Предполагается, что элемент сможет появляться в ответ на действие пользователя (например, <code>amp-lightbox</code>). Атрибуты <code>width</code> и <code>height</code> не требуются.</td>
    </tr>
    <tr>
      <td><code>responsive</code></td>
      <td>Элемент занимает доступное ему пространство и автоматически изменяет свою высоту в соответствии с соотношением сторон, заданным атрибутами <code>width</code> и <code>height</code>. Этот макет очень хорошо подходит для большинства элементов AMP, включая <code>amp-img</code>, <code>amp-video</code> и т. п. Доступное пространство зависит от родительского элемента и также может быть настроено с помощью CSS-свойства <code>max-width</code>. Атрибуты <code>width</code> и <code>height</code> должны быть указаны. <p> <strong>Примечание</strong>. Элементы с <code>"layout=responsive"</code> не имеют собственного размера; размер элемента определяется его контейнерным элементом. Чтобы гарантировать отображение элемента AMP, необходимо указать ширину и высоту содержащего его элемента. Не указывайте <code>"display:table"</code> для элемента-контейнера, поскольку это переопределит стиль отображения элемента AMP и сделает элемент AMP невидимым. </p>
</td>
    </tr>
  </tbody>
</table>

### `sizes` <a name="sizes"></a>

Все элементы AMP, поддерживающие макет `responsive`, также поддерживают атрибут `sizes`. Значением этого атрибута является выражение sizes, которое описано в статье [img sizes](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img), однако в данном контексте оно распространяется на все элементы, а не только на изображения. Атрибут `sizes` описывает, как рассчитывается ширина элемента в зависимости от условий его среды.

Когда атрибут `sizes` задается вместе с `width` и `height`, то `layout` по умолчанию получает значение `responsive`.

**Пример**: использование атрибута `sizes`

В следующем примере, если область просмотра шире `320px`, ширина изображения составит 320 пикселей; в противном случае его ширина будет равна 100vw (100% ширины области просмотра).

[sourcecode:html]
<amp-img
src="https://acme.org/image1.png"
width="400"
height="300"
layout="responsive"
sizes="(min-width: 320px) 320px, 100vw"

> </amp-img>
> [/sourcecode]

### `disable-inline-width` <a name="disable-inline-width"></a>

При отдельном использовании атрибута `sizes` он устанавливает элементу встроенный стиль `width`. При совместном использовании `sizes` с `disable-inline-width` элемент AMP распространяет значение `sizes` на дочерний тег элемента (например, на `img`, вложенные внутри `amp-img`). При этом, в отличие от самостоятельного применения <code>sizes</code> в AMP, встроенный стиль `width` не устанавливается.

**Пример**: использование атрибута `disable-inline-width`

В следующем примере ширина элемента `<amp-img>` не изменяется, а `sizes` используется только для выбора одного из источников из `srcset`.

[sourcecode:html]
<amp-img
src="https://acme.org/image1.png"
width="400"
height="300"
layout="responsive"
sizes="(min-width: 320px) 320px, 100vw"
disable-inline-width

> </amp-img>
> [/sourcecode]

### `heights` <a name="heights"></a>

Все элементы AMP, которые поддерживают макет `responsive`, также поддерживают атрибут `heights`. Значение этого атрибута представляет собой основанное на медиа-выражениях выражение, схожее со значением [атрибута sizes в img](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img), но с двумя ключевыми отличиями:

1. Оно относится к высоте, а не ширине элемента.
2. В нем допускаются процентные значения, например `86%`. Если используется процентное значение, оно указывает процентную долю ширины элемента.

Когда атрибут `heights` указывается вместе с `width` и `height`, то `layout` по умолчанию получает значение `responsive`.

**Пример**: использование атрибута `heights`

В следующем примере высота изображения по умолчанию составляет 80% от ширины, но если область просмотра шире `500px`, высота ограничивается значением `200px`. Поскольку атрибут `heights` указывается вместе с `width` и `height`, макет по умолчанию получает значение `responsive`.

[sourcecode:html]
<amp-img
src="https://acme.org/image1.png"
width="320"
height="256"
heights="(min-width:500px) 200px, 80%"

> </amp-img>
> [/sourcecode]

### `media` <a name="media"></a>

Атрибут `media` поддерживается большинством элементов AMP. В качестве значения атрибута `media` указывается медиа-запрос. Если фактические параметры клиента не соответствуют запросу, то рендеринг элемента не происходит, а его ресурсы (и, потенциально, ресурсы дочерних элементов) не загружаются. В случае изменения размеров или ориентации окна браузера медиа-запросы обрабатываются заново, после чего происходит скрытие или отображение элементов в зависимости от результата.

**Пример**: использование атрибута `media`

В следующем примере у нас есть 2 изображения с взаимоисключающими медиа-запросами. В зависимости от ширины экрана будет выбрано и отображено одно из двух изображений. Атрибут `media` доступен для всех элементов AMP, поэтому его можно использовать с элементами, не относящимися к изображениям, такими как реклама.

[sourcecode:html]
<amp-img
media="(min-width: 650px)"
src="wide.jpg"
width="466"
height="355"
layout="responsive"

> </amp-img>
> <amp-img
>   media="(max-width: 649px)"
>   src="narrow.jpg"
>   width="527"
>   height="193"
>   layout="responsive"
> </amp-img>
> [/sourcecode]

### `placeholder` <a name="placeholder"></a>

Атрибут `placeholder` можно добавить в любой элемент HTML, а не только в элементы AMP. Атрибут `placeholder` указывает, что элемент, отмеченный этим атрибутом, действует как заполнитель для родительского элемента AMP. Элемент-заполнитель должен быть прямым потомком элемента AMP. По умолчанию такой заполнитель отображается немедленно, даже если ресурсы элемента AMP не были загружены или проинициализированы. После завершения загрузки AMP-элемента заполнитель обычно скрывается для отображения реального содержимого. Конкретный способ обработки заполнителя зависит от реализации в элементе.

[sourcecode:html]
<amp-anim src="animated.gif" width="466" height="355" layout="responsive">
<amp-img placeholder src="preview.png" layout="fill"></amp-img>
</amp-anim>
[/sourcecode]

### `fallback` <a name="fallback"></a>

Атрибут `fallback` (обозначает резервный элемент) можно добавить в любой элемент HTML, а не только в элементы AMP. Резервный элемент — это способ сообщить пользователю, что браузер не поддерживает родительский элемент. Резервный элемент должен быть прямым потомком элемента AMP. Конкретный алгоритм отображения резервного элемента зависит от реализации в элементе.

[sourcecode:html]
<amp-anim src="animated.gif" width="466" height="355" layout="responsive">

  <div fallback>Cannot play animated images on this device.</div>
</amp-anim>
[/sourcecode]

### `noloading` <a name="noloading"></a>

`noloading` позволяет отключать индикатор загрузки элемента. Многие элементы AMP по умолчанию отображают т. н. «индикатор загрузки» — базовую анимацию, показывающую, что элемент еще не полностью загружен. Чтобы отключить индикатор в определенном элементе, добавьте в него этот атрибут.

## Сводная информация по требованиям макетов и их поведению <a name="tldr-summary-of-layout-requirements--behaviors"></a>

В следующей таблице описаны допустимые параметры, классы CSS и стили, используемые для атрибута `layout`. Обратите внимание, что:

1. Любой СSS-класс с префиксом `-amp-` и элементы с префиксом `i-amp-` считаются внутренними по отношению к AMP, и их нельзя применять в пользовательских таблицах стилей. Они представлены здесь исключительно в информационных целях.
2. Несмотря на то, что `width` и `height` указываются в таблице по мере необходимости, в некоторых ситуациях могут применяться правила по умолчанию, как в случае с `amp-pixel` и `amp-audio`.

<table>
  <thead>
    <tr>
      <th width="21%">Макет</th>
      <th width="20%">Требует указания ширины/<br>высоты?</th>
      <th width="20%">Указывает размер?</th>
      <th width="20%">Дополнительные элементы</th>
      <th width="19%">Значение CSS "display"</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>container</code></td>
      <td>Нет</td>
      <td>Нет</td>
      <td>Нет</td>
      <td><code>block</code></td>
    </tr>
    <tr>
      <td><code>fill</code></td>
      <td>Нет</td>
      <td>Да, родительский размер.</td>
      <td>Нет</td>
      <td><code>block</code></td>
    </tr>
    <tr>
      <td><code>fixed</code></td>
      <td>да</td>
      <td>Да, по <code>width</code> и <code>height</code>.</td>
      <td>Нет</td>
      <td><code>inline-block</code></td>
    </tr>
    <tr>
      <td><code>fixed-height</code></td>
      <td>только <code>height</code>; <code>width</code> может иметь значение <code>auto</code>
</td>
      <td>Да, определяется родительским контейнером и <code>height</code>.</td>
      <td>Нет</td>
      <td><code>block</code></td>
    </tr>
    <tr>
      <td><code>flex-item</code></td>
      <td>Нет</td>
      <td>Нет</td>
      <td>Да, на основе родительского контейнера.</td>
      <td><code>block</code></td>
    </tr>
    <tr>
      <td><code>intrinsic</code></td>
      <td>да</td>
      <td>Да, на основе родительского контейнера и соотношения сторон по <code>width:height</code>.</td>
      <td>Да, <code>i-amphtml-sizer</code>.</td>
      <td>
<code>block</code> (ведет себя как <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Replaced_element" rel="nofollow">замещаемый элемент</a>)</td>
    </tr>
    <tr>
      <td><code>nodisplay</code></td>
      <td>Нет</td>
      <td>Нет</td>
      <td>Нет</td>
      <td><code>none</code></td>
    </tr>
    <tr>
      <td><code>responsive</code></td>
      <td>да</td>
      <td>Да, на основе родительского контейнера и соотношения сторон по <code>width:height</code>.</td>
      <td>Да, <code>i-amphtml-sizer</code>.</td>
      <td><code>block</code></td>
    </tr>
  </tbody>
</table>
